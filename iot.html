<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IoT Device Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h2>IoT Device Management</h2>
    <p>Register and monitor smart bands / tags (demo).</p>

    <div class="mb-3">
      <button class="btn btn-primary" id="addDevice">Register New Device</button>
      <button class="btn btn-outline-secondary" id="syncAll">Sync Now (Demo)</button>
    </div>

    <table class="table table-bordered" id="deviceTable">
      <thead>
        <tr><th>Device ID</th><th>Status</th><th>Last Sync</th><th>Actions</th></tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script>
    // Demo storage for devices
    function loadDevices() {
      return JSON.parse(localStorage.getItem('iot_devices') || '[]');
    }
    function saveDevices(devices) {
      localStorage.setItem('iot_devices', JSON.stringify(devices));
    }

    function render() {
      const tbody = document.querySelector('#deviceTable tbody');
      tbody.innerHTML = '';
      const devices = loadDevices();
      devices.forEach(d => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.id}</td><td>${d.status}</td><td>${d.lastSync}</td>
                        <td><button class="btn btn-sm btn-danger" data-id="${d.id}">Remove</button></td>`;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('addDevice').addEventListener('click', () => {
      const devices = loadDevices();
      const id = 'Band-' + String(Math.floor(Math.random()*900 + 100));
      const now = new Date().toLocaleString();
      devices.unshift({ id, status: 'Active', lastSync: now });
      saveDevices(devices);
      render();
    });

    document.getElementById('syncAll').addEventListener('click', () => {
      const devices = loadDevices().map(d => ({ ...d, lastSync: new Date().toLocaleString() }));
      saveDevices(devices);
      render();
      alert('Sync complete (demo)');
    });

    document.querySelector('#deviceTable tbody').addEventListener('click', (e) => {
      if (e.target.matches('button')) {
        const id = e.target.dataset.id;
        let devices = loadDevices().filter(d => d.id !== id);
        saveDevices(devices);
        render();
      }
    });

    // init with a sample device if empty
    if (!loadDevices().length) {
      saveDevices([{ id: 'Band-001', status: 'Active', lastSync: new Date().toLocaleString() }]);
    }
    render();
  </script>
</body>
</html>
